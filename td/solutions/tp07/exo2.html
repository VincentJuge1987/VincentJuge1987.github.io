<!DOCTYPE html>
<html lang="fr">
 <head>
   <title>Horloges - Exercice 2</title>
   <meta charset="utf-8">
   <script>
     "use strict";
     
     const launch = function(...clocks) {
       window.setInterval(() => {
         const date = new Date();
         for(let clock of clocks) {
           clock.drawClock(date.getHours(), date.getMinutes(), date.getSeconds());
         }
       }, 1000);
     };
     
     class Clock{
       constructor(clockId) {
         const clock = document.getElementById(clockId);
         this.context = clock.getContext("2d");
         this.w = clock.width;
         this.h = clock.height;
         this.x = clock.width / 2;
         this.y = clock.height / 2;
         this.dimension = Math.min(this.x,this.y) - 10;
       }
       
       drawNeedle = function(width, lengthRatio, color, angle, maxAngle) {
         const [u,v] = fromPolar(this.x,this.y,this.dimension * lengthRatio,angle,maxAngle);
         const oldWidth = this.context.lineWidth;
         width = undefined ? oldWidth : width;
       
         this.context.lineWidth = width;
         this.context.strokeStyle = color;
         this.context.beginPath();
         this.context.moveTo(this.x,this.y);
         this.context.lineTo(u,v);
         this.context.stroke();
         this.context.lineWidth = oldWidth;
       }
       
       drawCircle = function(width, lengthRatio, color, points) {
         const oldWidth = this.context.lineWidth;
         const length = this.dimension * lengthRatio;
         width = undefined ? oldWidth : width;
       
         this.context.strokeStyle = color;
         this.context.lineWidth = width;
         this.context.beginPath();
         this.context.arc(this.x,this.y,length,0,2 * Math.PI);
         this.context.stroke();
         for (let i = 0; i < points; i++) {
           const [a,b] = fromPolar(this.x,this.y,length,i,points);
           const [A,B] = fromPolar(this.x,this.y,length-5,i,points);
           this.context.beginPath();
           this.context.moveTo(a,b);
           this.context.lineTo(A,B);
           this.context.stroke();
         }
         this.context.lineWidth = oldWidth;
       }
       
       drawClock = function(hours,minutes,seconds) {
         this.context.clearRect(0,0,this.w,this.h);
         this.drawCircle(3,1,"blue",12);
         this.drawNeedle(5,0.5,"green",hours, 12);
         this.drawNeedle(3,0.8,"black",minutes, 60);
         this.drawNeedle(undefined,0.9,"red",seconds, 60);
       }
     }
   
     const startClock = function(clockId) {
       return new Clock(clockId);
     };
     
     const fromPolar = function(x,y,length,angle,maxAngle) {
       const a = x + length * Math.sin(angle * 2 * Math.PI / maxAngle);
       const b = y - length * Math.cos(angle * 2 * Math.PI / maxAngle);
       return [a,b];
     };
   </script>
 </head>
 <body>
  <h2>Horloge 2</h2>
  <canvas id="clock1"
          width="200"
          height="200">
  </canvas>
  <canvas id="clock2"
          width="300"
          height="400">
  </canvas>
  <script>
    launch(startClock('clock1'),startClock('clock2'));
  </script>
 </body>
</html>
